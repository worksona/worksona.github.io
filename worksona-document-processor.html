<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worksona Document Processing Suite</title>
    <!-- Add Marked library for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Add PapaParse for CSV handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Add highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- Add Mermaid for diagram rendering -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Add Worksona.js -->
    <script src="worksona.min.js"></script>
    <style>
        /* Main layout styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            max-width: 1200px;
            height: 100vh;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            padding: 20px;
            padding-bottom: 60px;
            box-sizing: border-box;
        }

        /* Sidebar styles */
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px); /* Account for top/bottom padding and status bar */
            max-height: calc(100vh - 100px);
            overflow: hidden;
        }

        .agent-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            padding-right: 5px;
            flex: 1;
        }

        .agent-card {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .agent-card:hover {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .agent-card.active {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .agent-card h3 {
            margin: 0 0 5px 0;
            color: #1e40af;
            font-size: 16px;
        }

        .agent-card p {
            margin: 0;
            font-size: 14px;
            color: #64748b;
        }

        /* Main content area styles */
        .main-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: calc(100vh - 100px); /* Account for top/bottom padding and status bar */
            max-height: calc(100vh - 100px);
            overflow: hidden;
        }

        .file-upload-section {
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .file-upload-section.drag-over {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .file-upload-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        .file-upload-button:hover {
            background: #1d4ed8;
        }

        .processing-options {
            display: none;
            flex-shrink: 0;
        }

        .processing-option {
            display: none;
        }

        .output-section {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            background: #ffffff;
            font-size: 15px;
            line-height: 1.6;
            min-height: 0;
        }

        .output-section h1, 
        .output-section h2, 
        .output-section h3 {
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            color: #1e40af;
        }

        .output-section p {
            margin-bottom: 1em;
        }

        .output-section ul, 
        .output-section ol {
            margin-bottom: 1em;
            padding-left: 1.5em;
        }

        .output-section table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }

        .output-section th,
        .output-section td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }

        .output-section th {
            background: #f8fafc;
            font-weight: 600;
        }

        .output-section code {
            background: #f8fafc;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .output-section pre {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .steps-container {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 20px;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }

        .step {
            position: relative;
            z-index: 2;
            background: white;
            padding: 0 15px;
            text-align: center;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .step.active {
            opacity: 1;
        }

        .step.completed {
            opacity: 1;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: #64748b;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: #2563eb;
            color: white;
        }

        .step.completed .step-number {
            background: #4CAF50;
            color: white;
        }

        .step-label {
            font-size: 14px;
            font-weight: 500;
            color: #1e40af;
            white-space: nowrap;
        }

        /* Update existing sections to be step-aware */
        .section-container {
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .section-container.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Remove control panel styles */
        .control-panel,
        .control-panel-button,
        .control-panel-header,
        .control-panel-content,
        .control-panel-section,
        .control-panel-toggle,
        .control-panel-close,
        .api-key-input,
        .api-key-label,
        .provider-status,
        .status-light {
            display: none;
        }

        /* Add styles for API key management */
        .api-key-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }

        .api-key-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .api-key-input-group {
            display: flex;
            gap: 8px;
        }

        .api-key-input-group input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-family: monospace;
        }

        .api-key-input-group button {
            padding: 8px 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
        }

        .api-key-status {
            font-size: 12px;
            color: #64748b;
        }

        .api-key-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .save-button, .test-button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .save-button {
            background: #2563eb;
            color: white;
        }

        .test-button {
            background: #f1f5f9;
            color: #1e40af;
            border: 1px solid #e2e8f0;
        }

        .save-button:hover {
            background: #1d4ed8;
        }

        .test-button:hover {
            background: #eff6ff;
        }

        /* Add styles for LLM Configuration */
        .llm-config-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 20px 0;
        }

        .llm-provider-group {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
        }

        .llm-provider-group h4 {
            margin: 0 0 15px 0;
            color: #1e40af;
        }

        .llm-config-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .llm-config-item label {
            min-width: 120px;
            font-weight: 500;
        }

        .llm-config-item select,
        .llm-config-item input[type="number"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .llm-config-item input[type="range"] {
            flex: 1;
        }

        .llm-config-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .reset-button {
            padding: 8px 16px;
            background: #f1f5f9;
            color: #1e40af;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .reset-button:hover {
            background: #eff6ff;
        }

        /* Control Panel Styles */
        /* Commenting out custom control panel styles as we're using the built-in Worksona control panel */
        /*
        .control-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 1000px;
            height: 80vh;
            z-index: 1001;
            display: none;
            overflow: hidden;
        }

        .control-panel.active {
            display: flex;
            flex-direction: column;
        }

        .control-panel-header {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-panel-header h2 {
            margin: 0;
            color: #1e40af;
        }

        .control-panel-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
        }

        .control-panel-tabs {
            display: flex;
            padding: 0 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
        }

        .control-panel-tab {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .control-panel-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .control-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .control-panel-section {
            display: none;
        }

        .control-panel-section.active {
            display: block;
        }

        .control-panel-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 1000;
            transition: transform 0.2s;
        }

        .control-panel-toggle:hover {
            transform: scale(1.1);
        }

        /* Overlay styles */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
        }

        .overlay.active {
            display: block;
        }
        */

        /* Status bar styles */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1a;
            color: white;
            padding: 10px 20px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
        }

        /* Loading indicator */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        .agent-list::-webkit-scrollbar,
        .output-section::-webkit-scrollbar {
            width: 6px;
        }

        .agent-list::-webkit-scrollbar-track,
        .output-section::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .agent-list::-webkit-scrollbar-thumb,
        .output-section::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .agent-list::-webkit-scrollbar-thumb:hover,
        .output-section::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Responsive adjustments */
        @media (max-height: 700px) {
            .app-container {
                gap: 10px;
                padding: 10px;
                padding-bottom: 50px;
            }
            
            .sidebar, .main-content {
                height: calc(100vh - 80px);
                max-height: calc(100vh - 80px);
            }
            
            .steps-container {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .file-upload-section,
            .output-section {
                padding: 15px;
            }
            
            .status-bar {
                padding: 8px 15px;
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                height: auto;
                max-height: 30vh;
            }
            
            .main-content {
                height: auto;
                max-height: 65vh;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <h2>Document Processing Agents</h2>
            <div class="agent-list">
                <div class="agent-card" data-agent-id="text-analyzer" onclick="selectAgent('text-analyzer')">
                    <h3>Text Analyzer</h3>
                    <p>Analyzes text documents for key insights, sentiment, and summary</p>
                </div>
                <div class="agent-card" data-agent-id="markdown-specialist" onclick="selectAgent('markdown-specialist')">
                    <h3>Markdown Specialist</h3>
                    <p>Processes and enhances markdown documents, generates documentation</p>
                </div>
                <div class="agent-card" data-agent-id="csv-analyst" onclick="selectAgent('csv-analyst')">
                    <h3>CSV Analyst</h3>
                    <p>Analyzes CSV data, generates insights and visualizations</p>
                </div>
                <div class="agent-card" data-agent-id="json-processor" onclick="selectAgent('json-processor')">
                    <h3>JSON Processor</h3>
                    <p>Processes JSON data, validates structure, generates schemas</p>
                </div>
                <div class="agent-card" data-agent-id="docx-converter" onclick="selectAgent('docx-converter')">
                    <h3>DOCX Converter</h3>
                    <p>Converts and processes DOCX files into various formats</p>
                </div>
                <div class="agent-card" data-agent-id="report-generator" onclick="selectAgent('report-generator')">
                    <h3>Report Generator</h3>
                    <p>Creates professional business reports from processed data</p>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="steps-container">
                <div class="steps">
                    <div class="step active" id="step-1">
                        <div class="step-number">1</div>
                        <div class="step-label">Select Agent</div>
                    </div>
                    <div class="step" id="step-2">
                        <div class="step-number">2</div>
                        <div class="step-label">Upload Document</div>
                    </div>
                </div>
            </div>

            <div class="section-container active" id="section-1">
                <div class="agent-list">
                    <!-- Existing agent cards -->
                </div>
            </div>

            <div class="section-container" id="section-2">
                <div class="file-upload-section" id="upload-section" 
                    ondrop="handleDrop(event)" 
                    ondragover="handleDragOver(event)"
                    ondragleave="handleDragLeave(event)">
                    <h3>Upload Document</h3>
                    <p>Drag and drop your document here or click to select</p>
                    <input type="file" id="file-input" style="display: none" onchange="handleFileSelect(event)">
                    <button class="file-upload-button" onclick="document.getElementById('file-input').click()">
                        Select File
                    </button>
                </div>
            </div>

            <div class="section-container" id="section-3">
                <!-- Remove processing options buttons -->
            </div>

            <div class="output-section" id="output-section">
                <p>Output will appear here...</p>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div class="status-indicator">
            <div class="status-light"></div>
            <span id="status-text">Ready</span>
        </div>
        <div id="agent-status">No agent selected</div>
    </div>

    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // Global variables
        let worksona = null;
        let currentAgentId = null;
        let selectedOptions = new Set();
        let currentFile = null;

        // Initialize Worksona with API keys
        async function initializeWorksona() {
            try {
                updateStatus('Initializing Worksona...');
                
                // Load saved API keys
                const apiKeys = {};
                ['openai', 'anthropic', 'google'].forEach(provider => {
                    const key = localStorage.getItem(`${provider}_api_key`);
                    if (key) {
                        apiKeys[provider] = key;
                    }
                });
                
                // Initialize with saved API keys and enable built-in control panel
                worksona = new Worksona({
                    apiKeys: apiKeys,
                    debug: true,
                    controlPanel: true // Enable built-in control panel
                });

                // Load document processing agents
                await loadDocumentAgents();
                
                updateStatus('Ready');
            } catch (error) {
                console.error('Failed to initialize Worksona:', error);
                updateStatus('Initialization failed');
            }
        }

        // Load document processing agents
        async function loadDocumentAgents() {
            const agents = [
                {
                    id: 'text-analyzer',
                    name: 'Text Analyzer',
                    description: 'Advanced text analysis and processing specialist',
                    traits: {
                        personality: ['analytical', 'detail-oriented', 'thorough'],
                        knowledge: ['text analysis', 'NLP', 'sentiment analysis', 'content extraction'],
                        tone: 'professional and analytical',
                        background: 'Specialized in natural language processing and text analytics'
                    },
                    config: {
                        provider: 'openai',
                        model: 'gpt-4.1-2025-04-14',
                        temperature: 0.3,
                        maxTokens: 2500,
                        systemPrompt: `You are an expert text analysis specialist with deep expertise in natural language processing, linguistics, and content analysis. Your task is to provide a comprehensive analysis of text documents with the following components:

1. Executive Summary
   - Brief overview of the document
   - Key findings and main themes
   - Overall significance and context

2. Content Analysis
   - Main themes and topics identification
   - Key arguments or points presented
   - Supporting evidence and examples used
   - Narrative structure and flow analysis

3. Linguistic Analysis
   - Writing style and tone assessment
   - Vocabulary and language complexity analysis
   - Rhetorical devices and techniques used
   - Grammar and syntax patterns

4. Sentiment Analysis
   - Overall emotional tone
   - Emotional progression throughout the text
   - Key emotional triggers and their context
   - Objectivity vs. subjectivity assessment

5. Technical Elements
   - Document structure and organization
   - Formatting and presentation analysis
   - Citations and references (if applicable)
   - Technical terminology usage

6. Contextual Analysis
   - Historical or cultural context
   - Industry or domain-specific context
   - Target audience analysis
   - Purpose and intended impact

7. Critical Evaluation
   - Strengths and weaknesses
   - Credibility and authority assessment
   - Bias identification
   - Gaps or omissions in content

8. Recommendations
   - Suggested improvements
   - Areas for further development
   - Alternative approaches or perspectives
   - Enhancement opportunities

Present your analysis in a clear, well-structured format with detailed explanations and specific examples from the text. Use markdown formatting for better readability, including headers, lists, and emphasis where appropriate.`
                    }
                },
                {
                    id: 'markdown-specialist',
                    name: 'Markdown Specialist',
                    description: 'Expert in processing and enhancing markdown documents',
                    traits: {
                        personality: ['organized', 'precise', 'helpful'],
                        knowledge: ['markdown', 'documentation', 'technical writing'],
                        tone: 'clear and instructive',
                        background: 'Specialized in technical documentation and markdown processing'
                    },
                    config: {
                        provider: 'openai',
                        model: 'gpt-4.1-2025-04-14',
                        temperature: 0.4,
                        maxTokens: 2500,
                        systemPrompt: `You are an expert markdown documentation specialist with extensive experience in technical writing and documentation systems. Your task is to analyze, enhance, and optimize markdown documents with the following comprehensive approach:

1. Document Structure Analysis
   - Heading hierarchy and organization
   - Section flow and logical progression
   - Content completeness and coherence
   - Navigation and reference structure

2. Technical Content Enhancement
   - Code block formatting and syntax highlighting
   - Technical accuracy verification
   - API documentation standards compliance
   - Technical terminology consistency

3. Markdown Optimization
   - Syntax usage and best practices
   - Advanced markdown feature implementation
   - Cross-platform compatibility
   - Extended markdown syntax suggestions

4. Documentation Quality
   - Clarity and readability assessment
   - Completeness of information
   - Technical accuracy verification
   - Consistency in style and formatting

5. User Experience Considerations
   - Readability and accessibility
   - Navigation and information findability
   - Mobile responsiveness
   - Print-friendly formatting

6. Enhanced Features Implementation
   - Table of contents generation
   - Reference linking and citations
   - Metadata and front matter
   - Custom styling suggestions

7. Content Recommendations
   - Missing documentation identification
   - Additional section suggestions
   - Example and illustration opportunities
   - Interactive element possibilities

8. Version Control and Maintenance
   - Change tracking recommendations
   - Version numbering suggestions
   - Update and maintenance guidelines
   - Collaboration workflow suggestions

Provide a detailed analysis and enhancement proposal in a well-structured format, including specific examples and code snippets where relevant. Use proper markdown formatting to demonstrate best practices throughout your response.`
                    }
                },
                {
                    id: 'csv-analyst',
                    name: 'CSV Analyst',
                    description: 'Data analysis specialist for CSV files',
                    traits: {
                        personality: ['analytical', 'methodical', 'detail-oriented'],
                        knowledge: ['data analysis', 'statistics', 'data visualization'],
                        tone: 'technical and precise',
                        background: 'Expert in data analysis and statistical processing'
                    },
                    config: {
                        provider: 'openai',
                        model: 'gpt-4.1-2025-04-14',
                        temperature: 0.2,
                        maxTokens: 2500,
                        systemPrompt: `You are an expert data analyst specializing in CSV data analysis with deep knowledge of statistics, data visualization, and business intelligence. Your task is to provide comprehensive analysis of CSV data with the following components:

1. Data Overview
   - Dataset structure and dimensions
   - Column descriptions and data types
   - Data quality assessment
   - Missing value analysis

2. Statistical Analysis
   - Descriptive statistics for each column
   - Distribution analysis
   - Correlation analysis
   - Outlier detection and analysis

3. Trend Analysis
   - Time-series patterns (if applicable)
   - Seasonal trends identification
   - Growth/decline patterns
   - Cyclical behavior analysis

4. Data Quality Assessment
   - Data consistency check
   - Validation rules verification
   - Error detection and reporting
   - Data cleaning recommendations

5. Pattern Recognition
   - Key relationships between variables
   - Cluster analysis
   - Anomaly detection
   - Pattern significance testing

6. Business Insights
   - Key performance indicators
   - Critical metrics analysis
   - Business impact assessment
   - Decision-making recommendations

7. Visualization Recommendations
   - Suggested chart types
   - Key visualization points
   - Interactive dashboard proposals
   - Visual story-telling opportunities

8. Advanced Analytics
   - Predictive modeling opportunities
   - Machine learning potential
   - Feature importance analysis
   - Future trend projections

9. Technical Recommendations
   - Data structure optimization
   - Performance improvement suggestions
   - Data storage recommendations
   - Processing efficiency improvements

Present your analysis in a clear, structured format with detailed explanations, statistical evidence, and visual recommendations. Use markdown tables and formatting for better data presentation.`
                    }
                },
                {
                    id: 'json-processor',
                    name: 'JSON Processor',
                    description: 'JSON structure and validation specialist',
                    traits: {
                        personality: ['precise', 'systematic', 'technical'],
                        knowledge: ['JSON schema', 'data validation', 'API design'],
                        tone: 'technical and structured',
                        background: 'Specialized in JSON processing and schema design'
                    },
                    config: {
                        provider: 'openai',
                        model: 'gpt-4.1-2025-04-14',
                        temperature: 0.3,
                        maxTokens: 2500,
                        systemPrompt: `You are an expert JSON processing specialist with extensive experience in API design, data modeling, and schema validation. Your task is to analyze and optimize JSON structures with the following comprehensive approach:

1. Structure Analysis
   - JSON format validation
   - Object hierarchy analysis
   - Data type consistency
   - Naming convention assessment

2. Schema Generation
   - JSON Schema definition
   - Required vs optional fields
   - Data type specifications
   - Validation rules and constraints

3. Best Practices Review
   - Structure optimization
   - Nesting level assessment
   - Array handling efficiency
   - Object reference management

4. API Integration Analysis
   - RESTful API compatibility
   - GraphQL schema mapping
   - Webhook payload optimization
   - API versioning considerations

5. Performance Optimization
   - Size optimization
   - Parse/stringify efficiency
   - Caching recommendations
   - Compression opportunities

6. Security Assessment
   - Sensitive data identification
   - Security vulnerability check
   - Access control recommendations
   - Data protection strategies

7. Documentation Generation
   - Schema documentation
   - Usage examples
   - Integration guidelines
   - Error handling documentation

8. Compatibility Analysis
   - Cross-platform compatibility
   - Browser support assessment
   - Mobile optimization
   - Legacy system compatibility

Present your analysis in a detailed, technical format with specific recommendations, code examples, and best practice guidelines. Use markdown formatting for clear presentation of technical details.`
                    }
                },
                {
                    id: 'docx-converter',
                    name: 'DOCX Converter',
                    description: 'DOCX processing and conversion specialist',
                    traits: {
                        personality: ['efficient', 'adaptable', 'detail-oriented'],
                        knowledge: ['document processing', 'format conversion', 'content extraction'],
                        tone: 'professional and helpful',
                        background: 'Expert in document format conversion and processing'
                    },
                    config: {
                        provider: 'openai',
                        model: 'gpt-4.1-2025-04-14',
                        temperature: 0.3,
                        maxTokens: 2500,
                        systemPrompt: `You are an expert document conversion specialist with deep knowledge of various document formats and content processing. Your task is to analyze and convert DOCX documents with the following comprehensive approach:

1. Document Analysis
   - Structure and formatting assessment
   - Content type identification
   - Style usage analysis
   - Special element inventory

2. Content Extraction
   - Text content processing
   - Table structure analysis
   - Image and media handling
   - Mathematical formula conversion

3. Formatting Preservation
   - Style mapping strategy
   - Font and typography handling
   - Layout preservation approach
   - Special character handling

4. Cross-Format Optimization
   - Format-specific features
   - Compatibility considerations
   - Alternative format suggestions
   - Conversion trade-offs

5. Metadata Management
   - Document properties
   - Author information
   - Version tracking
   - Reference preservation

6. Quality Assurance
   - Content integrity verification
   - Format consistency check
   - Link validation
   - Reference accuracy

7. Enhancement Opportunities
   - Accessibility improvements
   - SEO optimization
   - Interactive element additions
   - Mobile responsiveness

8. Technical Recommendations
   - Conversion tool suggestions
   - Automation possibilities
   - Batch processing strategies
   - Error handling procedures

Present your analysis and conversion results in a detailed format with specific attention to formatting, structure, and content preservation. Use markdown to demonstrate the converted content effectively.`
                    }
                },
                {
                    id: 'report-generator',
                    name: 'Report Generator',
                    description: 'Business report creation specialist',
                    traits: {
                        personality: ['professional', 'organized', 'business-oriented'],
                        knowledge: ['business reporting', 'data visualization', 'executive summaries'],
                        tone: 'professional and concise',
                        background: 'Specialized in creating professional business reports'
                    },
                    config: {
                        provider: 'openai',
                        model: 'gpt-4.1-2025-04-14',
                        temperature: 0.4,
                        maxTokens: 2500,
                        systemPrompt: `You are an expert business report generator with extensive experience in business analysis, data presentation, and executive communication. Your task is to create comprehensive business reports with the following components:

1. Executive Summary
   - Key findings overview
   - Critical insights
   - Strategic implications
   - Recommended actions

2. Business Context
   - Industry analysis
   - Market conditions
   - Competitive landscape
   - Regulatory environment

3. Data Analysis
   - Key metrics evaluation
   - Performance indicators
   - Trend analysis
   - Comparative benchmarks

4. Financial Impact
   - Revenue implications
   - Cost analysis
   - ROI calculations
   - Budget considerations

5. Risk Assessment
   - Strategic risks
   - Operational risks
   - Market risks
   - Mitigation strategies

6. Strategic Recommendations
   - Short-term actions
   - Long-term strategy
   - Implementation roadmap
   - Resource requirements

7. Implementation Plan
   - Timeline and milestones
   - Resource allocation
   - Budget requirements
   - Success metrics

8. Visual Presentation
   - Data visualization
   - Executive dashboards
   - Key charts and graphs
   - Infographic elements

9. Appendices
   - Detailed data tables
   - Methodology
   - Source citations
   - Supporting documentation

Present your report in a professional, executive-friendly format with clear sections, visual elements, and actionable insights. Use markdown formatting for optimal readability and presentation.`
                    }
                }
            ];

            for (const agent of agents) {
                await worksona.loadAgent(agent);
            }
        }

        // Select an agent
        function selectAgent(agentId) {
            if (!worksona) return;
            
            currentAgentId = agentId;
            
            // Update UI
            document.querySelectorAll('.agent-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-agent-id="${agentId}"]`).classList.add('active');
            
            const agent = worksona.getAgent(agentId);
            document.getElementById('agent-status').textContent = `Selected: ${agent.name}`;
            
            // Move to next step
            updateSteps(2);
            
            // Clear output
            document.getElementById('output-section').innerHTML = '<p>Ready to process documents...</p>';
        }

        // File handling functions
        function handleDragOver(event) {
            event.preventDefault();
            event.target.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.target.classList.remove('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.target.classList.remove('drag-over');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        async function handleFile(file) {
            if (!currentAgentId) {
                updateStatus('Please select an agent first');
                return;
            }

            currentFile = file;
            updateStatus(`Processing ${file.name}...`);
            showLoading(true);

            try {
                const content = await readFile(file);
                const result = await processDocument(content, file.type);
                displayResult(result);
                updateStatus('Processing complete');
            } catch (error) {
                console.error('Error processing file:', error);
                updateStatus('Error processing file');
                document.getElementById('output-section').innerHTML = 
                    `<p style="color: red;">Error: ${error.message}</p>`;
            } finally {
                showLoading(false);
            }
        }

        // Read file content
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('Error reading file'));
                
                if (file.type.includes('text') || file.name.endsWith('.md') || file.name.endsWith('.json')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsArrayBuffer(file);
                }
            });
        }

        // Process document based on type and selected options
        async function processDocument(content, fileType) {
            const agent = worksona.getAgent(currentAgentId);
            if (!agent) throw new Error('No agent selected');

            let prompt = `Analyze and process the following document content comprehensively according to your expertise:\n\n${content}`;
            return await worksona.chat(currentAgentId, prompt);
        }

        // Display processing result
        function displayResult(result) {
            const outputSection = document.getElementById('output-section');
            
            // Parse markdown in the result
            const htmlContent = marked.parse(result);
            
            outputSection.innerHTML = htmlContent;
            
            // Initialize Mermaid diagrams
            mermaid.init({
                startOnLoad: true,
                theme: 'default',
                securityLevel: 'loose',
                flowchart: { useMaxWidth: true }
            });
            
            // Apply syntax highlighting to code blocks
            outputSection.querySelectorAll('pre code').forEach((block) => {
                if (!block.classList.contains('mermaid')) {
                    hljs.highlightElement(block);
                }
            });
        }

        // Toggle processing options
        function toggleOption(element) {
            // Function removed
        }

        function updateOptionCompatibility() {
            // Function removed
        }

        function checkOptionCompatibility(option, fileType, agentId) {
            // Function removed
        }

        // Process document with selected options
        async function processWithOptions() {
            if (!currentFile || !currentAgentId || selectedOptions.size === 0) return;

            showLoading(true);
            updateStatus('Processing with selected options...');

            try {
                const content = await readFile(currentFile);
                const result = await processDocument(content, currentFile.type);
                displayResult(result);
                updateStatus('Processing complete');
            } catch (error) {
                console.error('Error processing file:', error);
                updateStatus('Error processing file');
                document.getElementById('output-section').innerHTML = 
                    `<p style="color: red;">Error: ${error.message}</p>`;
            } finally {
                showLoading(false);
            }
        }

        // Update status message
        function updateStatus(message) {
            document.getElementById('status-text').textContent = message;
        }

        // Show/hide loading overlay
        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // Update step management functions
        function updateSteps(currentStep) {
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                if (stepNum === currentStep) {
                    step.classList.add('active');
                } else if (stepNum < currentStep) {
                    step.classList.add('completed');
                }
            });

            // Update section visibility
            document.querySelectorAll('.section-container').forEach((section, index) => {
                const sectionNum = index + 1;
                section.classList.toggle('active', sectionNum === currentStep);
            });
        }

        // Initialize the application with step management
        window.onload = async function() {
            // Initialize Mermaid
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default',
                securityLevel: 'loose',
                flowchart: { useMaxWidth: true }
            });
            
            await initializeWorksona();
            updateSteps(1);
        };
    </script>
</body>
</html> 